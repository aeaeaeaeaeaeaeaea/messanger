<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">

<head>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css"
		integrity="sha384-DhY6onE6f3zzKbjUPRc2hOzGAdEf4/Dz+WJwBvEYL/lkkIsI3ihufq9hk9K4lVoK" crossorigin="anonymous">

	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style media="screen">
		small {
			font-size: 13px;
		}

		body {
			font-size: 15px;
		}

		.text-large {
			font-size: 18px !important;
		}

		.text-xlarge {
			font-size: 24px !important;
		}

		/* .dropdown-reset button { font-size: inherit; }
  .dropdown-reset button:after { display: none; } */
		.bg-theme-color {
			background: #5683a4
		}

		.fx-fadein {
			animation: opac .25s;
		}

		@keyframes opac {
			from {
				opacity: 0
			}

			to {
				opacity: 1
			}
		}
	</style>


</head>

<body class="body d-flex flex-column h-100" style="overflow: hidden;">

	<div class="d-flex flex-column bg-light" style="height:100%">
		<div class="row g-0" style="height:100%">

			<!-- SIDEBAR -->
			<div class="col-5 col-md-4 flex-column border-right overflow-auto" style="height:100vh">
				<div class="d-flex bg-theme-color px-3 py-2">
					<div class="flex-grow-1">

						<!--<img src="https://www.w3schools.com/w3images/avatar3.png" class="rounded-circle" width="40"
							alt="">-->

					</div>


				</div>

				<div class="px-3 py-2 bg-white">

					<div class="d-flex bg-lightgray rounded-lg border-0">

						<div class="ml-1 px-2 py-2 text-gray">
							<i class="zmdi zmdi-search text-large"></i>
						</div>

						<!-- Форма для поиска user'ов -->
						<form class="col-8" action="/users" method="GET">
							<input class="d-inline border-0 rounded-pill px-3 py-2" type="text" name="userName"
								placeholder="Search or start new chat" />
						</form>



					</div>

				</div>

				<div th:if="${searchElasticUser == null}">

					<div th:if="${!chatList.isEmpty()}">

						<div class="flex-grow-1 scroll">



							<ul th:each="chatRoom : ${chatList}" class="list-group">

								<!-- Для SenderId -->
								<div th:if="${chatRoom.getSenderId().equals(currentUser)}">

									<li class="list-group-item border-0 d-flex">

										<!-- Ссылка на чат и последенее сообщение -->
										<div class="chat-link text-large ml-3 flex-grow-1">

											<a id="link" th:text="${chatRoom.getRecipientName()}"
												th:data="${chatRoom.getId()}"
												th:href="@{/chat/{chatId}(chatId = ${chatRoom.getId()})}">
											</a>


											<br />
											<small class="text-gray text-right">

												<i class="zmdi zmdi-check-all" style="font-size:16px!important"
													th:if="${lastMessages.get(chatRoom.getId()).getContent() != null}"
													th:text="${lastMessages.get(chatRoom.getId()).getContent()}">
												</i>

											</small>
										</div>
										<!-- -->

										<!-- Время последнего сообщения -->
										<div class="text-gray">

											<small th:if="${lastMessages.get(chatRoom.getId()).getContent() != null}">

												<small
													th:if="${todayDate.equals(lastMessages.get(chatRoom.getId()).getSendTime().format(formatter))}"
													th:text="${lastMessages.get(chatRoom.getId()).getSendTime().format(todayFormat)}">
													text
												</small>

												<small
													th:if="${!todayDate.equals(lastMessages.get(chatRoom.getId()).getSendTime().format(formatter))}"
													th:text="${lastMessages.get(chatRoom.getId()).getSendTime().format(formatter)}">
													text
												</small>


											</small>

											<br>

										</div>
										<!-- Конец -->

									</li>

								</div>
								<!-- Конец -->

								<!-- Для RecipientId -->
								<div th:if="${chatRoom.getRecipientId().equals(currentUser)}">

									<li class="list-group-item border-0 d-flex">

										<!-- Ссылка на чат и последенее сообщение -->
										<div class="chat-link text-large ml-3 flex-grow-1">

											<a id="link" th:text="${chatRoom.getSenderName()}"
												th:data="${chatRoom.getId()}"
												th:href="@{/chat/{chatId}(chatId = ${chatRoom.getId()})}">

											</a>

											<br />

											<small class="text-gray text-right">

												<i class="zmdi zmdi-check-all" style="font-size:16px!important"
													th:if="${lastMessages.get(chatRoom.getId()).getContent() != null}"
													th:text="${lastMessages.get(chatRoom.getId()).getContent()}">

												</i>

											</small>
										</div>
										<!-- -->

										<!-- Время последнего сообщения -->
										<div class="text-gray">

											<small th:if="${lastMessages.get(chatRoom.getId()).getContent() != null}">

												<small
													th:if="${todayDate.equals(lastMessages.get(chatRoom.getId()).getSendTime().format(formatter))}"
													th:text="${lastMessages.get(chatRoom.getId()).getSendTime().format(todayFormat)}">
													text
												</small>

												<small
													th:if="${!todayDate.equals(lastMessages.get(chatRoom.getId()).getSendTime().format(formatter))}"
													th:text="${lastMessages.get(chatRoom.getId()).getSendTime().format(formatter)}">
													text
												</small>


											</small>

											<br>

										</div>
										<!-- Конец -->

									</li>

								</div>
								<!-- Конец -->


							</ul>


						</div>

					</div>

					<div th:if="${chatList.isEmpty()}">

						<ul th:each="user : ${users}">

							<div th:if="${user.getId() != currentUser}">

								<li class="list-group-item border-0 d-flex">

									<!-- Кнопка создания чата -->
									<div class="chat-link text-large ml-3 flex-grow-1">

										<a class="chat-create" id="chat" th:data-user-id="${user.getId()}"
											th:data-current-user="${currentUser}"
											th:text="${user.getUsername()} + ' ' + ${user.getId()}">
											text
										</a>

									</div>
									<!-- Конец -->

								</li>

							</div>

						</ul>

					</div>

				</div>

				<div th:if="${searchElasticUser != null}">

					<div class="flex-grow-1 scroll">

						<ul th:each="user : ${searchElasticUser}" class="list-group">

							<li class="list-group-item border-0 d-flex" th:if="${user.getId() != currentUser}">

								<div class="chat-link text-large ml-3 flex-grow-1">

									<a class="chat-create" th:data-user-id="${user.getId()}"
										th:data-current-user="${currentUser}"
										th:text="${user.getUserName()} + ' ' + ${user.getId()}">
										text
									</a>


								</div>

							</li>

						</ul>

					</div>

				</div>

			</div>

			<!-- Empty space -->
			<div class="col-7 col-md-8 flex-column" style="height:100vh;">

				<div style="background-color: rgb(248, 248, 248); height: 100vh"
					class="d-flex justify-content-center align-items-center">

					<p class="text-center">Select a chat to start messaging</p>

				</div>

			</div>
			<!-- End of empty space -->




		</div>
	</div>

	<!-- Modal window for an editing and deleting chat -->
	<div class="modal" id="myModal" style="display: none;">
		<div class="modal-dialog">
			<div class="modal-content">

				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>

				<div class="modal-body">
					<button id="deleteButton" class="btn btn-danger">Удалить чат</button>
					<button id="editButton" class="btn btn-primary">Очистить сообщения</button>
				</div>

			</div>
		</div>
	</div>
	<!-- End -->

	<!-- Скрипт для удаления чатов и очистки сообщений в них -->
	<script src="/js/chatScripts/ChatDelete.js"></script>

	<!-- Скрипт для создания чатов -->
	<script src="/js/chatScripts/ChatCreate.js"></script>


</body>

</html>